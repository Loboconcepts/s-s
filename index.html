<!DOCTYPE html>
<html>
<head>
	<title>Dinner Party</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<style type="text/css">
		body {
			margin:0;
			-webkit-touch-callout: none;
			-webkit-user-select: none; /* Disable selection/copy in UIWebView */
		}
		td {
			border-right:solid 1px #333333;
			padding: 0 10px;

		}
		table {
			border-spacing: 0px;
		}
	</style>
</head>
<body>
	<canvas id="game"></canvas>
	<button onclick="window.clearTimeout(go)">STOP</button>
	<div style="font-size:10px;" id="purpose_actions"></div>
	<script src="js/main.js"></script>
	
	<script type="text/javascript">
		// TO DO:

		//############# STARTING VARIABLES ################//

		var mansion = new Map (5,4, [0,
			5,0,0,0,2,
			4,0,0,0,1,
			3,0,7,0,2,
			5,0,0,0,1
			]);
		var player = new Player(3.5,1,1,{
			greeting: ["Good", "Bad"],
			introduce: ["REAL NAME", "FAKE NAME"],
			blackout: ["I don't know", "That was suspicious"],

		});
		var camera = new Camera(canvas);
		var controls = new Controls();

		// GUEST:              Neutral guest. Will not murder others.
		// MURDERER:           Neutral guest. Will murder others.
		// CORRUPT:            Neutral guest. Will not murder others.
		// AVENGER:            Neutral guest. Will murder specific guest.
		// OCCULTIST:          Influences guests. Will murder guests.
		// AGENT:              Protects guests. Will murder murderer.
		// SPY:                Influence guests. Will murder undercover agent.
		// VENDOR:             Entertains guests. Can murder based on disposition

		// x,y,direction,texture,persona,logic,suspicion

		var cornelia_cornhowser = new AI(3.3,1,1,new Bitmap('./assets/annalee-hawthorn.png',2000,1200),{
			full_name: "Cornelia Cornhowser",
			genre: "GUEST",
			inches : 82,
			conversation: {
				topic : "greeting",
				greeting: ["Hey there, how are you?",{
					0: "Great!",
					1: "Sorry to hear that."
				},false],
				introduce : ["My name is Cornelia.", {
					0: "Pleaure.",
					1: "Pleasure."
				},false],
				blackout : ["What was that?", {
					0: "",
					1: ""
				},false]
			}
			
		},{purpose:"die", act:"stand"},0);

		var dogingo_dogergie = new AI(2.3,1,1,new Bitmap('./assets/annalee-hawthorn.png',2000,1200),{
			full_name: "Dogingo Dogerie",
			genre: "GUEST",
			inches: 87,
			conversation: {
				topic : "greeting",
				greeting: ["How's it hangin, dude?",{
					0: "Sweet dude!",
					1: "Dang dude."
				},false],
				introduce : ["My moniker is Dogingo, dude.", {
					0: "Glad to meet ya dude.",
					1: "Glad to meet ya dude."
				},false],
				blackout : ["What was that?", {
					0: "",
					1: ""
				},false]
			}
			
		},{purpose:"think", act:"stand"},0);
 
		var fransesca_flamenco = new AI(4.8,1,1,new Bitmap('./assets/annalee-hawthorn.png',2000,1200),{
			full_name: "Fransesca Flamenco",
			genre: "GUEST",
			inches: 78,
			conversation: {
				topic : "greeting",
				greeting: ["Howdy partner. How ya doing?",{
						0: "That's hot.",
						1: "That's cold."
					},false],
				introduce : ["Hi. I'm Fransesca!", {
						0: "Pleasure is all mine.",
						1: "Pleasure is all mine."
					},false],
				blackout : ["What was that?", {
					0: "",
					1: ""
				},false]
			}
			
		},{purpose:"think", act:"stand"},0);

		var ariah_keller = new AI(4.8,1,1,new Bitmap("./assets/ariah-keller.png",2000,1200),{ full_name: "Ariah Keller", genre: "GUEST", inches: 81, conversation: { topic : "greeting", greeting: ["Howdy partner. How ya doing?",{ 0: "That's hot.", 1: "That's cold." },false], introduce : ["Hi. I'm Ariah!", { 0: "Pleasure is all mine.", 1: "Pleasure is all mine." },false], blackout : ["What was that?", { 0: "", 1: "" },false] } },{purpose:"think", act:"stand"},0);

		var shepherd_cooper = new AI(4.8,1,1,new Bitmap("./assets/shepherd-cooper.png",2000,1200),{ full_name: "Shepherd Cooper", genre: "GUEST", inches: 89, conversation: { topic : "greeting", greeting: ["Howdy partner. How ya doing?",{ 0: "That's hot.", 1: "That's cold." },false], introduce : ["Hi. I'm Shepherd!", { 0: "Pleasure is all mine.", 1: "Pleasure is all mine." },false], blackout : ["What was that?", { 0: "", 1: "" },false] } },{purpose:"think", act:"stand"},0);

		var sunwell_sunflower = new AI(2.5,1,1,new Bitmap('./assets/annalee-hawthorn.png',2000,1200),{
			full_name: "Sunwell Sunflower",
			genre: "MURDERER",
			inches: 98,
			conversation: {
				topic : "greeting",
				greeting: ["How does the rest of your life look?",
					{
						0: "Hmmm.",
						1: "I can help with that."
					},
				false],
				introduce : ["Sunwell. Leave me alone.", 
					{
						0: "Go away.",
						1: "Go away."
					},
				false],
				blackout : ["What do you want?", {
					0: "",
					1: ""
				},false]
			}
		},{purpose:"think", act:"stand"},3);

		var perry_periscope = new AI(4.3,1,1,new Bitmap('./assets/perry-periscope.png',2000,1200),{
			full_name: "Perry Periscope",
			genre: "AGENT",
			inches: 92,
			conversation: {
				topic : "greeting",
				greeting: ["Hey pal. How's it going?",
					{
						0: "Glad to hear it.",
						1: "Damn shame."
					},
				false],
				introduce : ["The name's Perry.", 
					{
						0: "Nice to meet you.",
						1: "Nice to meet you."
					},
				false],
				blackout : ["What was that?", {
					0: "",
					1: ""
				},false]
			}
		},{purpose:"think", act:"stand"},1);


		var AI_array = [sunwell_sunflower,perry_periscope,cornelia_cornhowser,shepherd_cooper,ariah_keller];
		var everyone_array = [player,sunwell_sunflower,perry_periscope,cornelia_cornhowser,shepherd_cooper,ariah_keller];
		
		
		// window.addEventListener("blur",function(ev) {if(gameState == state_EXPLORE)gameState = state_PAUSED}, true);
		// window.addEventListener("focus",function(ev) {if(gameState == state_PAUSED)gameState = state_EXPLORE}, true);


		 function show_characters_logic() {
			var report = [];
			for (var i=0;i<AI_array.length;i++) {
				report.push("<tr><td>"+AI_array[i].persona.full_name+"</td>");
				report.push("<td>"+AI_array[i].logic.purpose+"</td>");
				report.push("<td>"+AI_array[i].logic.act+"</td></tr>");
				
			}
			document.getElementById("purpose_actions").innerHTML = "<table><tr><td><strong>Character</strong></td><td><strong>Purpose</strong></td><td><strong>Action</strong></td></tr>"+report.join(" ")+"</table><br>Time: "+ time.join(" : ");
		}

		var start = new Start()

		function Start() {
			this.counter = 0
			this.mansion_assets = false;
			this.ai_assets = false;
			this.player_assets = false;
			this.loading_bar = 0;
		}

		Start.prototype.load = function() {
			

			if (!this.mansion_assets) {
				for (var i =0;i<mansion.texture.length;i++) {
					if (mansion.texture[i].image.complete) this.counter++, this.loading_bar++;
				}
				if (this.counter >= mansion.texture.length) {
					this.mansion_assets = true;
				}
			}
			else if (this.mansion_assets && !this.ai_assets) {
				this.loading_bar += mansion.texture.length;
				for (var i =0;i<AI_array.length;i++) {
					if (AI_array[i].texture.image.complete) this.counter++, this.loading_bar++;
				}
				if (this.counter >= AI_array.length) {
					this.ai_assets = true;
				}
			}
			else if (this.mansion_assets && this.ai_assets && !this.player_assets) {
				if (player.texture.image.complete) {
					return init();
				}
			}
			camera.ctx.save();
			camera.ctx.fillStyle = "rgba(0,0,0,1)"
			camera.ctx.fillRect(0,0,camera.width,camera.height);
			camera.ctx.restore();
			camera.ctx.save();
			camera.ctx.fillStyle = "rgba(250,250,250,1)"
			camera.ctx.fillRect(20,camera.height/2,20+(this.loading_bar*10),20);
			camera.ctx.restore();
			this.counter = 0;
			this.loading_bar = 0;
			
			window.setTimeout(start.load,50)
			
		}

		function startScreen(con) {
			camera.ctx.save();
			camera.ctx.fillStyle = "rgba(0,0,0,1)"
			camera.ctx.fillRect(0,0,camera.width,camera.height);
			camera.ctx.restore();
			camera.ctx.save();
			camera.ctx.font = camera.width/12 + 'px Monaco';
			camera.ctx.textAlign = "center"
			camera.ctx.fillStyle = "rgba(255,255,150,1)"
			camera.ctx.fillText('START',camera.width/2,camera.height/2);
			camera.ctx.restore();
			if (controls.states.up) {
				start.load();
			}
			else {
				window.setTimeout(startScreen,100)	
			}
			
		}

		startScreen();
		
		

	</script>

</body>
</html>